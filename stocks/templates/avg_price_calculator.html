{% extends 'base.html' %}

{% block title %}Average Price Calculator{% endblock %}
{% block header_title %}Average Price Calculator{% endblock %}
{% block header_subtitle %}Calculate the average price per share including existing and new stock transactions.{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md card-hover transition-all duration-300 p-6">
    <form id="calcForm" method="post" class="space-y-4">
        {% csrf_token %}
        <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Stock Symbol</label>
            <input type="text" name="stock_symbol" id="stockSymbol" class="w-full p-3 border rounded-lg focus:border-indigo-600 focus:outline-none" value="{{ stock_symbol|default:'' }}" required>
        </div>
        {% if existing_shares %}
        <div class="mb-4">
            <h3 class="font-bold text-lg mb-2">Existing Shares for {{ stock_symbol }}</h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-indigo-50 text-gray-700">
                            <th class="p-3 text-left">Quantity</th>
                            <th class="p-3 text-left">Price per Share (₹)</th>
                            <th class="p-3 text-left">Total Cost (₹)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for share in existing_shares %}
                        <tr class="border-t hover:bg-gray-50 transition-colors">
                            <td class="p-3">{{ share.quantity }}</td>
                            <td class="p-3">{{ share.price_per_share|floatformat:2 }}</td>
                            <td class="p-3">{{ share.total_cost|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                        <tr class="border-t font-semibold">
                            <td class="p-3">Total: {{ existing_total_shares }}</td>
                            <td class="p-3">-</td>
                            <td class="p-3">{{ existing_total_cost|floatformat:2 }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
        <div id="transactionsContainer" class="space-y-4">
            <h3 class="font-bold text-lg mb-2">New Transactions</h3>
            <div class="transaction-row flex space-x-4 items-end">
                <div class="flex-1">
                    <label class="block text-gray-700 font-medium mb-1">Quantity</label>
                    <input type="number" name="quantity[]" class="w-full p-3 border rounded-lg focus:border-indigo-600 focus:outline-none" required>
                </div>
                <div class="flex-1">
                    <label class="block text-gray-700 font-medium mb-1">Price per Share (₹)</label>
                    <input type="number" step="0.01" name="price[]" class="w-full p-3 border rounded-lg focus:border-indigo-600 focus:outline-none" required>
                </div>
                <button type="button" class="remove-row bg-red-600 text-white p-3 rounded-lg hover:bg-red-700 transition-colors">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <button type="button" id="addRow" class="w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-400 hover:text-indigo-600 hover:border-indigo-300 transition-colors flex items-center justify-center">
            <i class="fas fa-plus mr-2"></i> Add Another Transaction
        </button>
        <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
            <i class="fas fa-calculator mr-2"></i> Calculate Average Price
        </button>
    </form>
    {% if result %}
    <div class="mt-6 p-4 bg-indigo-50 rounded-lg">
        <h3 class="font-bold text-lg mb-2">Calculation Result for {{ result.stock_symbol }}</h3>
        <p class="text-gray-700">Total Shares (Existing + New): {{ result.total_shares }}</p>
        <p class="text-gray-700">Total Investment: ₹{{ result.total_cost|floatformat:2 }}</p>
        <p class="text-indigo-600 font-semibold">Average Price per Share: ₹{{ result.avg_price|floatformat:2 }}</p>
    </div>
    {% endif %}
</div>
{% endblock %}